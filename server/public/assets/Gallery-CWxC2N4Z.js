import{G as B}from"./Button-BA7JgBjB.js";import{_ as F,c as i,o as a,a as l,d as C,w as k,v as b,F as m,r as _,e as A,f as O,g as U,t as v,h,i as S,j as G,k as R,b as y,l as x}from"./app-CEv5AtwB.js";const E={name:"ResetIcon"},L={xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",fill:"currentColor",viewBox:"0 0 16 16",class:"reset-icon"};function M(c,e,u,d,n,o){return a(),i("svg",L,[...e[0]||(e[0]=[l("path",{d:"M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"},null,-1),l("path",{d:"M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"},null,-1)])])}const j=F(E,[["render",M]]),z={name:"GalleryFilters",components:{ResetIcon:j},props:{initialFilters:{type:Object,default:()=>({category:"",date:"",sort:"newest"})},customCategories:{type:Array,default:()=>[]},customDateOptions:{type:Array,default:()=>[]},customSortOptions:{type:Array,default:()=>[]},showResetIcon:{type:Boolean,default:!0}},data(){return{localFilters:{...this.initialFilters}}},computed:{categories(){return this.customCategories.length>0?this.customCategories:[{value:"nature",label:"Природа"},{value:"portrait",label:"Портреты"},{value:"architecture",label:"Архитектура"},{value:"events",label:"События"},{value:"art",label:"Искусство"},{value:"food",label:"Еда"}]},dateOptions(){return this.customDateOptions.length>0?this.customDateOptions:[{value:"today",label:"Сегодня"},{value:"week",label:"За неделю"},{value:"month",label:"За месяц"},{value:"year",label:"За год"},{value:"custom",label:"Выбрать период..."}]},sortOptions(){return this.customSortOptions.length>0?this.customSortOptions:[{value:"newest",label:"Сначала новые"},{value:"oldest",label:"Сначала старые"},{value:"popular",label:"По популярности"},{value:"name_asc",label:"По названию (А-Я)"},{value:"name_desc",label:"По названию (Я-А)"}]},hasActiveFilters(){return this.localFilters.category||this.localFilters.date||this.localFilters.sort!=="newest"},resetTooltip(){if(this.hasActiveFilters){const c=[];if(this.localFilters.category){const e=this.categories.find(u=>u.value===this.localFilters.category);e&&c.push(`Категория: ${e.label}`)}if(this.localFilters.date){const e=this.dateOptions.find(u=>u.value===this.localFilters.date);e&&c.push(`Период: ${e.label}`)}if(this.localFilters.sort!=="newest"){const e=this.sortOptions.find(u=>u.value===this.localFilters.sort);e&&c.push(`Сортировка: ${e.label}`)}return`Сбросить фильтры: ${c.join(", ")}`}return"Сбросить фильтры"}},methods:{emitFilters(){this.$emit("filters-changed",{...this.localFilters})},resetFilters(){this.localFilters={category:"",date:"",sort:"newest"},this.emitFilters()},reset(){this.resetFilters()},updateFilters(c){this.localFilters={...this.localFilters,...c},this.emitFilters()},getCurrentFilters(){return{...this.localFilters}}},watch:{initialFilters:{handler(c){this.localFilters={...c}},deep:!0}}},D={class:"filters-container"},N={class:"filters-section"},T={class:"filter-group"},W=["value"],H={class:"filter-group"},J=["value"],q={class:"filter-group"},K=["value"],P=["title"];function Q(c,e,u,d,n,o){const f=U("ResetIcon");return a(),i("div",D,[l("div",N,[l("div",T,[e[8]||(e[8]=l("label",{for:"category-filter"},"Категория:",-1)),k(l("select",{id:"category-filter","onUpdate:modelValue":e[0]||(e[0]=s=>n.localFilters.category=s),class:"filter-select",onChange:e[1]||(e[1]=(...s)=>o.emitFilters&&o.emitFilters(...s))},[e[7]||(e[7]=l("option",{value:""},"Все категории",-1)),(a(!0),i(m,null,_(o.categories,s=>(a(),i("option",{key:s.value,value:s.value},v(s.label),9,W))),128))],544),[[b,n.localFilters.category]])]),l("div",H,[e[10]||(e[10]=l("label",{for:"date-filter"},"Дата:",-1)),k(l("select",{id:"date-filter","onUpdate:modelValue":e[2]||(e[2]=s=>n.localFilters.date=s),class:"filter-select",onChange:e[3]||(e[3]=(...s)=>o.emitFilters&&o.emitFilters(...s))},[e[9]||(e[9]=l("option",{value:""},"За все время",-1)),(a(!0),i(m,null,_(o.dateOptions,s=>(a(),i("option",{key:s.value,value:s.value},v(s.label),9,J))),128))],544),[[b,n.localFilters.date]])]),l("div",q,[e[11]||(e[11]=l("label",{for:"sort-filter"},"Сортировка:",-1)),k(l("select",{id:"sort-filter","onUpdate:modelValue":e[4]||(e[4]=s=>n.localFilters.sort=s),class:"filter-select",onChange:e[5]||(e[5]=(...s)=>o.emitFilters&&o.emitFilters(...s))},[(a(!0),i(m,null,_(o.sortOptions,s=>(a(),i("option",{key:s.value,value:s.value},v(s.label),9,K))),128))],544),[[b,n.localFilters.sort]])]),o.hasActiveFilters?(a(),i("button",{key:0,onClick:e[6]||(e[6]=(...s)=>o.resetFilters&&o.resetFilters(...s)),class:"reset-filters-btn",title:o.resetTooltip},[u.showResetIcon?(a(),A(f,{key:0})):C("",!0),e[12]||(e[12]=O(" Сбросить фильтры ",-1))],8,P)):C("",!0)])])}const X=F(z,[["render",Q],["__scopeId","data-v-39ae4689"]]),Y={name:"UploadIcon"},Z={xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16",class:"upload-icon"};function ee(c,e,u,d,n,o){return a(),i("svg",Z,[...e[0]||(e[0]=[l("path",{d:"M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"},null,-1),l("path",{d:"M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z"},null,-1)])])}const te=F(Y,[["render",ee],["__scopeId","data-v-1184f3d5"]]),le={class:"gallery-module"},se={key:0,class:"guest-view"},oe={class:"guest-content"},re={class:"guest-actions"},ae={key:1},ie={class:"gallery-header"},ne={class:"header-controls"},ue={class:"gallery-content"},ce={key:0,class:"loading"},de={key:1,class:"error"},ve={key:2},pe={key:0,class:"empty"},he={key:1,class:"gallery-grid"},fe=["src","alt"],ge={class:"item-info"},ye={class:"artist"},me={class:"year"},_e={__name:"Gallery",setup(c){const e=h(!1),u=h(null),d=h([]),n=h(null),o=h({artist:null,style:null,year:null});S(()=>{let t=[...d.value];return o.value.artist&&(t=t.filter(r=>r.artist_id==o.value.artist||r.artistId==o.value.artist)),o.value.style&&(t=t.filter(r=>r.style===o.value.style)),o.value.year&&(t=t.filter(r=>r.year==o.value.year)),t});const f=()=>{try{const t=localStorage.getItem("currentUser")||sessionStorage.getItem("currentUser");t&&(n.value=JSON.parse(t))}catch(t){console.error("Error checking auth:",t),n.value=null}},s=t=>{o.value=t,console.log("Фильтры изменены:",t)},$=async()=>{if(n.value)try{e.value=!0,u.value=null,console.log("Loading gallery...",{user:n.value.email,token:n.value.token?"present":"missing"});const t=n.value.token,r=await fetch("http://localhost:3000/api/artworks",{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(console.log("Response status:",r.status),!r.ok){const w=await r.text();throw console.error("Error response:",w),new Error(`Ошибка сервера: ${r.status}`)}const g=await r.json();console.log("Response data:",g),d.value=g.artworks||[],d.value.length===0&&(u.value="В галерее пока нет картин")}catch(t){console.error("Ошибка загрузки галереи:",t),u.value=t.message||"Не удалось загрузить галерею",d.value=[]}finally{e.value=!1}},V=t=>t&&!t.startsWith("http")&&!t.startsWith("//")?`http://localhost:3000${t.startsWith("/")?t:`/${t}`}`:t,I=t=>{t.key==="currentUser"&&(f(),n.value&&$())};return G(()=>{f(),$(),window.addEventListener("storage",I)}),R(()=>{window.removeEventListener("storage",I)}),(t,r)=>{const g=U("router-link"),w=U("UploadPopup");return a(),i("div",le,[n.value?(a(),i("div",ae,[l("div",ie,[r[4]||(r[4]=l("h1",null,"Галерея",-1)),l("div",ne,[y(X,{initialFilters:t.initialFilters,onFiltersChanged:s},null,8,["initialFilters"]),y(B,{text:"Загрузить изображения",variant:"primary",onClick:r[0]||(r[0]=()=>{})},{default:x(()=>[y(te)]),_:1})]),t.showUploadPopup?(a(),A(w,{key:0,onClose:t.closeUploadPopup,onUploadComplete:t.handleUploadComplete},null,8,["onClose","onUploadComplete"])):C("",!0)]),l("div",ue,[e.value?(a(),i("div",ce,"Загрузка галереи...")):u.value?(a(),i("div",de,v(u.value),1)):(a(),i("div",ve,[d.value.length===0?(a(),i("div",pe,"Картин пока нет")):(a(),i("div",he,[(a(!0),i(m,null,_(d.value,p=>(a(),i("div",{key:p.id,class:"gallery-item"},[l("img",{src:V(p.image),alt:p.title},null,8,fe),l("div",ge,[l("h3",null,v(p.title),1),l("p",ye,v(p.artist),1),l("p",me,v(p.year),1)])]))),128))]))]))])])):(a(),i("div",se,[l("div",oe,[r[2]||(r[2]=l("h2",null,"Требуется авторизация",-1)),r[3]||(r[3]=l("p",null,"Для просмотра галереи необходимо войти в систему",-1)),l("div",re,[y(g,{to:"/profile",class:"btn-primary"},{default:x(()=>[...r[1]||(r[1]=[O(" Войти / Зарегистрироваться ",-1)])]),_:1})])])]))])}}},ke=F(_e,[["__scopeId","data-v-1d8d4422"]]);export{ke as default};
